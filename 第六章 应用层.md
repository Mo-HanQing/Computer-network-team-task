# 第六章 应用层

## 一、网络应用模型

1. 客户/服务器模型（C/S）
    - 客户机
      - 主动发出请求
    - 服务器
      - 一直运行
      - 被动接收请求
      - 提供服务
    - 网络中各计算机的地位不平等（用户权限）
    - 客户机之间不能直接通信
    - 客户机数量有限（受网络带宽和服务器硬件影响）

2. P2P 模型
    - 各计算机（对等方）没有固定的客户和服务器划分
    - 对等方直接相互通信
    - 可将任务分配到各个借点
    - 单个结点失效不会影响其他部分的结点
    - 占用较多内存，影响整机速度

## 二、域名系统 DNS

- 域名系统（DNS）
  - 是因特网使用的命名系统
  - 用来把便于人们记忆的具有特定含义的主机名，转换为便于机器处理的 IP 地址
  - 采用 客户/服务器模型
  - 端口号 53
  - 三部分
    - 层次域名空间
    - 域名服务器
    - 解析器

1. 层次域名空间（便于人们记忆的具有特定含义的主机名）
    - 因特网采用层次树状结构的命名方法
    - 域名
      - 任何连接到因特网的主机或路由器，都有一个唯一的层次结构名称
      - 由标号组成
        - 标号之间用“.”隔开
        - 标号英文不区分大小写
        - 每个标号不超过 63 个字符
        - 多标号组成的完整域名最长不超过 255 个字符
        - 域名级别从左到右依次升高
    - 域
      - 是一个可被管理的划分
      - 域可以被划分为子域
        - 子域还可以继续划分为子域的子域
          - 形成了顶级域、二级域、三级域  

        ><www.mohanqing.com>
        www：三级域名
        mohanqing：二级域名
        com：顶级域名

    <img src="./imgs/域名空间的树状结构.png">

2. 域名服务器
    - 域名到 IP 地址的解析是由运行在域名服务器上的程序完成的
    - 区
      - 一个服务器所负责管辖的范围称为区
      - 一个区中的所有结点必须是能够连通的
      - 每个区设置相应的权限域名服务器
        - 用来保存该区中的所有主机的域名到 IP 地址的映射，完成域名到 IP 地址的解析
        - 并具有连向其他域名服务器的信息
          - 当自己不能进行域名解析时
          - 能够找到其他域名服务器
    - 有四种域名服务器
      1. 根域名服务器
          - 是最高层次的域名服务器
          - 所有的根域名服务器都知道所有的顶级域名服务器的域名和 IP 地址
          - 本地域名服务器只要无法对某个域名进行解析，就要首先求助于根域名服务器
          - 根域名服务器通常不进行域名解析，而是告诉本地域名服务器下一步应当找哪一个顶级域名服务器
      2. 顶级域名服务器
          - 管理该顶级域名服务器注册的所有二级域名
      3. 权限域名服务器（授权域名服务器）
          - 每台主机都必须在权限域名服务器处登记
          - 许多域名服务器都同时充当本地域名服务器和权限域名服务器
      4. 本地域名服务器
          - 当一台主机发出 DNS 查询请求时
            - 这个查询请求报文就发送给该主机的本地域名服务器

    <img src="./imgs/DNS层次结构.png">

3. 域名解析过程
    - 当客户端需要域名解析时
      - 通过本机的 DNS 客户端构造一个 DNS 请求报文
      - 以 UDP 数据报的方式发往本地域名服务器
    - 域名解析有两种方式
      1. 递归查询
          - 主机向本地域名服务器的查询都采用递归查询
          - 本地域名服务器以 DNS 客户的身份，向根域名服务器继续发出查询报文
            - 而不是让该主机自己进行下一步的查询
      2. 迭代查询
          - 本地域名服务器向根域名服务器的查询通常是迭代查询
          - 当根域名服务器收到本地域名服务器发出的迭代查询请求报文时
            - 要么给出所要查询的 IP 地址
            - 要么返回下一步应当查询哪个顶级域名服务器进行查询
            - 然后让本地域名服务器进行后续的查询
          - 顶级域名服务器收到查询报文后同理
      - 本地域名服务器向其他域名服务器采用递归查询或迭代查询
      <img src="./imgs/递归查询.png">
      <img src="./imgs/迭代查询.png">

## 三、文件传送协议FTP

- 文件传送协议FTP
  - 提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限。
  - 屏蔽了各计算机系统的细节，适合于在异构网络中任意计算机之间传送文件。

1. FTP 的特点

    - 只提供文件传送的一些基本服务，它使用 TCP 可靠的运输服务。
    - 主要功能：减少或消除在不同操作系统下处理文件的不兼容性。
    - 使用客户服务器方式。
    - 一个 FTP 服务器进程可同时为多个客户进程提供服务。
    - FTP 的服务器进程由两大部分组成：
      - 一个主进程，负责接受新的请求；
      - 若干个从属进程，负责处理单个请求。

2. FTP 主进程的工作步骤

    - 打开熟知端口（端口号为 21），使客户进程能够连接上。
    - 等待客户进程发出连接请求。
    - 启动从属进程来处理客户进程发来的请求。
      - 从属进程对客户进程的请求处理完毕后即终止
      - 从属进程在运行期间根据需要还可能创建其他一些子进程。
    - 回到等待状态，继续接受其他客户进程发来的请求。
      - 主进程与从属进程的处理是并发地进行。
    <img src = "./imgs/FTP使用两个不同的端口号.png">

## 四、简单文件传送协议 TFTP

- 简单文件传送协议 TFTP
  - TFTP (Trivial File Transfer Protocol) 是一个很小且易于实现的文件传送协议。
  - 使用客户服务器方式和使用 UDP 数据报，因此 TFTP 需要有自己的差错改正措施。
  - 只支持文件传输，不支持交互。
  - 没有庞大的命令集，没有列目录的功能，也不能对用户进行身份鉴别。
  - 优点：（1）可用于 UDP 环境；（2）代码所占的内存较小。

1. TFTP 主要特点
    - 每次传送的数据报文中有 512 字节的数据（最后一次可以不足 512 字节）。
    - 数据报文按序编号，从 1 开始。
    - 支持 ASCII 码或二进制传送。
    - 可对文件进行读或写。
    - 使用很简单的首部。

2. 工作方式

    （类似停止等待协议）
    - 发送完一个文件块后就等待对方的确认，确认时应指明所确认的块编号。
    - 发完数据后在规定时间内收不到确认就要重发数据 PDU。
    - 发送确认 PDU 的一方若在规定时间内未收到下一个文件块，需重发确认 PDU，保证文件的传送不致因某一个数据报的丢失而告失败。

3. 工作过程

    - 开始工作时，TFTP 客户进程发送一个读请求或写请求报文给 TFTP 服务器进程，其 UDP 熟知端口号码为 69。
    - TFTP 服务器进程选择一个新的端口和 TFTP 客户进程进行通信。
    - 若文件长度恰好为 512 字节的整数倍，则在文件传送完毕后，还必须在最后发送一个只含首部而无数据的数据报文。
    - 若文件长度不是 512 字节的整数倍，则最后传送数据报文的数据字段一定不满 512 字节，作为文件结束的标志。

## 五、远程终端协议 TELNET

1. 远程终端协议 TELNET

    - 是一个简单的远程终端协议，是互联网的正式标准。
    - 允许用户在其所在地通过 TCP 连接注册（即登录）到远地的另一个主机上（使用主机名或 IP 地址）。
    - 能将用户的击键传到远地主机，同时也能将远地主机的输出通过 TCP 连接返回到用户屏幕。
    - 服务是透明的。
    - 又称为终端仿真协议。
    - 使用客户 - 服务器方式
      - 在本地系统运行 TELNET 客户进程，而在远地主机则运行 TELNET 服务器进程。
      - 服务器中的主进程等待新的请求，产生从属进程来处理每一个连接。
    - 使用网络虚拟终端 NVT 格式
      - TELNET 的选项协商 (Option Negotiation) 使客户和服务器可商定使用更多的终端功能，协商的双方是平等的。
      - 能够适应许多计算机和操作系统的差异
    <img src = "./imgs/TELNET使用网络虚拟终端NVT格式.png">

2. NVT（Network Virtual Terminal）格式

    - 客户端把用户的击键和命令转换成 NVT 格式，并送交服务器。
    - 服务器端把收到的数据和命令，从 NVT 格式转换成远地系统所需的格式。
    - 向客户返回数据时，服务器把远地系统的格式转换为 NVT 格式，本地客户再从 NVT 格式转换到本地系统所需的格式。
    - 格式定义：分两种字符集，数据字符和控制字符。
    <img src = "./imgs/NVT格式定义.png">
